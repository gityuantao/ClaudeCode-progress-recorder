# Progress Recorder 项目记忆管理系统

## 🎯 方案概述

Progress Recorder 专门解决 Claude Code 开发项目时信息散落的问题。重要的决策、任务进度、技术约束等信息会散落在对话历史中，随着对话轮次增加容易被遗忘或难以查找。

这个系统会自动识别对话中的关键信息，并持续维护一个 progress.md 文件作为项目的核心文档。所有重要信息都会被结构化地记录在这里。

## 🏗️ 系统架构

```
┌──────────────────┐
│    CLAUDE.md     │ ← 规则层：定义触发条件和指令集
├──────────────────┤
│ record/recap/    │ ← 处理层：三个专门的 agent
│ archive agents   │   负责记录、回顾、归档
├──────────────────┤
│   progress.md    │ ← 工作记忆：当前项目状态
│progress.archive  │ ← 历史记忆：完整项目历程
└──────────────────┘
```

## 📋 核心指令集

### /record
触发记录当前对话内容中的关键信息。基于语义识别系统会自动分类：

**📌 Pinned（关键约束）**：
- "必须支持..."、"不能使用..."、"严禁..."
- "兼容性要求..."、"法规要求..."、"安全限制..."

**🎯 Decisions（历史决策）**：
- "决定使用/采用/选择..."、"确定用..."
- "最终选择..."、"批准..."、"通过..."

**📝 TODO（待办任务）**：
- "需要实现/开发/添加..."、"要做..."
- "计划..."、"安排..."、"下一步..."

**✅ Done（完成事项）**：
- "完成了..."、"做好了..."、"搞定了..."
- "上线了..."、"发布了..."、"部署了..."

### /recap
快速回顾项目当前状态，30秒内了解项目完整情况：
- 🎯 核心约束（Pinned）- 分级保护的关键限制
- 📋 决策历程（Decisions）- 分级保护的历史决策
- 📝 任务生命周期状态（TODO: OPEN→DOING→DONE）
- 🔥 当前焦点任务（P0高优先级）
- ✅ 最近完成事项（含证据链接）
- ⚠️ 需要关注的事项

### /archive
执行历史记录归档操作，保持主文件清爽：
- **自动触发**：Notes + Done 超过 100 条时
- **手动触发**：项目里程碑、技术栈切换、团队交接时
- **分级保护**：Pinned 和 Decisions 永不归档
- **保留策略**：最近 50 条 Done 和 Notes，其余归档

## 🧠 语义识别机制

### 置信度判定系统
**高置信度（写入受保护区块）**：
- 强承诺语言："必须"、"决定"、"确定"、"不能"、"严禁"
- 批准语言："批准"、"通过"、"采用"

**低置信度（降级到 Notes）**：
- 弱化表达："可能"、"建议"、"或许"、"考虑"、"想要"
- 自动标注：`[Needs-Confirmation]`

### 自动触发规则
当对话中出现以下语言模式时，系统会自动调用 record agent：

**决策类语言**（→ Decisions）：
- "决定使用/采用/选择..."、"确定用..."
- "最终选择..."、"就用...了"、"定下来了..."

**约束类语言**（→ Pinned）：
- "必须支持/兼容..."、"不能使用..."、"严禁..."
- "要求..."、"限制是..."、"法规要求..."

**任务类语言**（→ TODO）：
- "需要实现/开发/添加..."、"要做..."
- "计划..."、"准备..."、"下一步..."

**完成类语言**（→ Done）：
- "完成了..."、"做好了..."、"搞定了..."
- "已经..."、"弄完了..."、"上线了..."

## 🔒 核心设计原则

### 1. 分级保护机制
- **Pinned** 和 **Decisions** 一旦记录就永不自动修改
- 这些是用户明确的"硬约束"和"确定决策"
- 新的相关信息只在 Notes 中提醒，不覆盖历史

### 2. 增量合并策略
- 相似任务会更新原有条目而非创建重复项
- 新决策与旧决策冲突时，在 Notes 中记录提醒而不覆盖历史
- 确保信息的连续性和完整性，避免重复记录或丢失历史

### 3. 任务生命周期管理
- 每个 TODO 都有唯一 ID（#1, #2...）和优先级（P0/P1/P2）
- 支持 OPEN→DOING→DONE 的完整状态流转
- Done 项目关联证据链接（commit、PR、文件路径等）

### 4. 历史不可变原则
- Decisions 按时间顺序追加，旧决策永远保留
- 归档文件采用只增不删策略，确保完整的项目历史可追溯
- 新决策不会覆盖历史，保持决策演进的完整记录

## 📊 progress.md 文件结构

```markdown
# 项目进度记录

## 📌 Pinned（关键约束）
<!-- 不可变的核心要求和限制，永不自动修改 -->
- 必须支持中文界面
- 兼容 Safari 浏览器

## 🎯 Decisions（历史决策）
<!-- 按时间顺序的重要决策记录，永不自动修改 -->
- [2024-09-24] 决定使用 TypeScript 开发
- [2024-09-24] 选择 React 作为前端框架

## 📝 TODO（待办任务）
<!-- 每个任务有唯一ID和优先级，支持状态流转 -->
- #1 [P1] [OPEN] 实现自动记录功能

## ✅ Done（完成事项）
<!-- 已完成任务，包含完成日期和证据链接 -->
- #2 [P0] [DONE] 配置项目基础结构 [2024-09-24] (commit: abc123)

## 💡 Notes（临时笔记）
<!-- 其他信息，讨论记录，提醒事项 -->
- 考虑引入 Redis 缓存 [Needs-Confirmation]
```

## 🔄 归档机制详解

### 触发阈值
- **主要条件**：Notes + Done 条目总数 ≥ 100 条
- **备用条件**：progress.md 文件大小 > 50KB

### 保留策略
```
永不归档（分级保护）:
├── 📌 Pinned（关键约束）
├── 🎯 Decisions（历史决策）
└── 📝 TODO（所有待办任务）

归档策略:
├── ✅ Done - 保留最近 50 条，其余按月份归档
└── 💡 Notes - 保留最近 50 条，其余按月份归档
```

### 归档文件格式
```markdown
# Progress Archive - 项目历史归档

## 📋 归档说明
- 归档日期：2024-09-24 10:30
- 归档内容：Done记录 75 条，Notes记录 38 条

## ✅ 历史完成事项 (Done Archives)
### 2024年8月 (25 条)
- #15 [P1] [DONE] 用户认证模块 [2024-08-15] (commit: def456)

## 💡 历史笔记 (Notes Archives)
### 2024年8月 (15 条)
- [2024-08-20] 性能优化建议记录
```

## ⚙️ 使用建议

### 项目启动阶段
1. 使用 `/record` 记录初始需求和核心约束
2. 明确表达技术决策："决定使用 Next.js"
3. 记录关键限制："必须支持移动端"

### 开发过程中
1. 重要决策时明确表达："确定采用 MongoDB"
2. 任务分配时使用："需要实现用户认证"
3. 完成工作时报告："完成了登录功能"

### 定期维护
1. 使用 `/recap` 回顾项目状态和进展
2. 长期项目定期 `/archive` 整理历史记录
3. 里程碑完成时手动归档整理

## 🎯 系统优势

### 持久记忆能力
- 替代传统对话历史查找，提供结构化项目记忆
- 适合需要持续几天或几周的项目开发
- 支持团队成员快速了解项目状态

### 智能信息管理
- 基于语义理解的自动分类，避免手工整理
- 置信度判定避免把讨论想法误作确定决策
- 增量合并机制确保信息连续性

### 长期可维护性
- 分级保护确保关键信息永不丢失
- 自动归档保持文档清爽可读
- 只增不删的历史记录保证完整可追溯

这个系统相当于给 Claude Code 增加了一个轻量但实用的项目记忆能力，特别适合需要长期维护、持续开发的项目。